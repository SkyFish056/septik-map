<!DOCTYPE html>
<html>
<head>
    <title>Карта дилеров</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://api-maps.yandex.ru/2.1/?apikey=888ae0cd-1515-4762-9738-a15768a83edf&lang=ru_RU" type="text/javascript"></script>
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        ///// НАЧАЛО ИЗМЕНЕНИЙ /////
        function addDealersToMap(map, dealers) {
            // Удаляем старые метки (если есть)
            map.geoObjects.removeAll();
            
            // Добавляем каждого дилера на карту
            dealers.forEach(dealer => {
                const placemark = new ymaps.Placemark(
                    dealer.coords,
                    {
                        hintContent: dealer.name,
                        balloonContent: `
                            <b>${dealer.name}</b><br>
                            <b>Город:</b> ${dealer.city}<br>
                            <b>Адрес:</b> ${dealer.address}<br>
                            <b>Телефон:</b> <a href="tel:${dealer.phone}">${dealer.phone}</a><br>
                            <b>Email:</b> <a href="mailto:${dealer.email}">${dealer.email}</a>
                        `,
                        iconCaption: dealer.city
                    },
                    {
                        preset: 'islands#blueDotIcon'
                    }
                );
                map.geoObjects.add(placemark);
            });

            // Автоматически подгоняем карту под метки
            if (dealers.length > 0) {
                map.setBounds(map.geoObjects.getBounds());
            }
        }

        function init() {
            try {
                const map = new ymaps.Map('map', {
                    center: [55.76, 37.64], // Москва
                    zoom: 4,
                    controls: ['searchControl', 'zoomControl']
                });

                // Загружаем данные дилеров
                fetch('dealers.json')
                    .then(response => {
                        if (!response.ok) throw new Error('Ошибка загрузки данных');
                        return response.json();
                    })
                    .then(dealers => {
                        console.log('Дилеры загружены:', dealers); // Для отладки
                        addDealersToMap(map, dealers);
                    })
                    .catch(error => {
                        console.error('Ошибка:', error);
                        alert('Не удалось загрузить дилеров. Проверьте консоль (F12).');
                    });

            } catch (error) {
                console.error('Произошла ошибка:', error);
                alert('Произошла ошибка при загрузке карты. Пожалуйста, обновите страницу.');
            }
        }
        ///// КОНЕЦ ИЗМЕНЕНИЙ /////
        
        ymaps.ready(init);
    </script>
</body>
</html>